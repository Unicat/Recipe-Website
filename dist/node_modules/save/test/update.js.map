{"version":3,"sources":["../../../../node_modules/save/test/update.js"],"names":["extend","require","async","should","module","exports","idProperty","getEngine","describe","it","done","error","engine","create","a","insertedObject","not","exist","update","savedObject","eql","on","entity","message","_id","undefined","object","map","b","objects","extraSet","compositeObject","newObject","be","type","newProperty","have","property"],"mappings":"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","file":"update.js","sourcesContent":["var extend = require('lodash.assign')\n  , async = require('async')\n  , should = require('should')\n\nmodule.exports = function(idProperty, getEngine) {\n\n  describe('#update()', function () {\n\n    it('should return the full entity', function (done) {\n\n      getEngine(function (error, engine) {\n        engine.create({ a: 1 }, function (error, insertedObject) {\n          should.not.exist(error)\n\n          engine.update(insertedObject, function (error, savedObject) {\n\n            should.not.exist(error)\n            savedObject.should.eql(insertedObject)\n            done()\n          })\n        })\n      })\n    })\n\n    it('should emit a \\'update\\' event', function (done) {\n      getEngine(function (error, engine) {\n        engine.create({ a: 1 }, function (error, insertedObject) {\n          engine.on('update', function (entity) {\n            entity.should.eql(insertedObject)\n            done()\n          })\n          engine.update(insertedObject)\n        })\n      })\n    })\n\n    it('should emit a \\'afterUpdate\\' event', function (done) {\n      getEngine(function (error, engine) {\n        engine.create({ a: 1 }, function (error, insertedObject) {\n          engine.on('afterUpdate', function (entity) {\n            entity.should.eql(insertedObject)\n            done()\n          })\n          engine.update(insertedObject)\n        })\n      })\n    })\n\n    it('should error if there is no id property', function (done) {\n      getEngine(function (error, engine) {\n        engine.update({ a: 1 }, function (error) {\n          error.message.should.eql('Object has no \\'' + idProperty + '\\' property')\n          done()\n        })\n      })\n    })\n\n    it('should error if there an id property that is null/undefined', function (done) {\n      getEngine(function (error, engine) {\n        engine.update({ _id: null, a: 1 }, function (error) {\n          error.message.should.eql('Object has no \\'' + idProperty + '\\' property')\n          getEngine(function (error, engine) {\n            engine.update({ _id: undefined, a: 1 }, function (error) {\n              error.message.should.eql('Object has no \\'' + idProperty + '\\' property')\n              done()\n            })\n          })\n        })\n      })\n    })\n\n    it('should error if there are no objects in the store with given id', function (done) {\n      getEngine(function (error, engine) {\n        var object = { a: 1 }\n        object[idProperty] = 1\n        engine.update(object, function (error) {\n          error.message.should.eql('No object found with \\'' + idProperty + '\\' = \\'1\\'')\n          done()\n        })\n      })\n    })\n\n    it('should modify and return object by adding new properties', function (done) {\n      getEngine(function (error, engine) {\n        async.map([ { a: 1, b: 1 } ], engine.create, function (error, objects) {\n          var extraSet = { b: 2 }\n          extraSet[idProperty] = objects[0][idProperty]\n          engine.update(extraSet, function (error, savedObject) {\n            var compositeObject = extend({}, objects[0], extraSet)\n            savedObject.should.eql(compositeObject)\n            done()\n          })\n        })\n      })\n    })\n\n    it('should overwrite original properties when option is passed', function (done) {\n      getEngine(function (error, engine) {\n        async.map([ { a: 1 } ], engine.create, function (error, objects) {\n          var newObject = { b: 2 }\n          newObject[idProperty] = objects[0][idProperty]\n          engine.update(newObject, true, function (error, savedObject) {\n            savedObject.should.eql(newObject)\n            done()\n          })\n\n        })\n      })\n    })\n\n    it('should return id of type String', function (done) {\n      getEngine(function (error, engine) {\n        async.map([ { a: 1 } ], engine.create, function (error, objects) {\n          var newObject = { b: 2 }\n          newObject[idProperty] = objects[0][idProperty]\n          engine.update(newObject, true, function (error, savedObject) {\n            savedObject[idProperty].should.be.type('string')\n            done()\n          })\n\n        })\n      })\n    })\n\n    it('should return a unreferenced overridden object when override is true', function (done) {\n      getEngine(function (error, engine) {\n        async.map([ { a: 1 } ], engine.create, function (error, objects) {\n          var newObject = { b: 2 }\n          newObject[idProperty] = objects[0][idProperty]\n\n          engine.update(newObject, true, function (error, savedObject) {\n            savedObject.newProperty = true\n            newObject.should.not.have.property('newProperty')\n            done()\n          })\n        })\n      })\n    })\n\n    it('should return a unreferenced object when override is false', function (done) {\n      getEngine(function (error, engine) {\n        async.map([ { a: 1 } ], engine.create, function (error, objects) {\n          var newObject = { b: 2 }\n          newObject[idProperty] = objects[0][idProperty]\n\n          engine.update(newObject, false, function (error, savedObject) {\n            savedObject.newProperty = true\n            newObject.should.not.have.property('newProperty')\n            done()\n          })\n        })\n      })\n    })\n\n  })\n\n}\n"]}